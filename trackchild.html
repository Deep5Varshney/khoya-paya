<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/trackchild.css">
    <title>Track child</title>
</head>
<body onload="cap()">
    <form>
        <div class="container">
            <div class="heading">
                <h3>Check the status of your missing child report</h3>
            </div>
            <div class="details">
                <label>State :</label>
                <select id="state" name="state" required>
                    <option value="">Select State</option>
                    <option value="Andhra Pradesh">Andhra Pradesh</option>
                    <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                    <option value="Assam">Assam</option>
                    <option value="Bihar">Bihar</option>
                    <option value="Chhattisgarh">Chhattisgarh</option>
                    <option value="Goa">Goa</option>
                    <option value="Gujarat">Gujarat</option>
                    <option value="Haryana">Haryana</option>
                    <option value="Himachal Pradesh">Himachal Pradesh</option>
                    <option value="Jharkhand">Jharkhand</option>
                    <option value="Karnataka">Karnataka</option>
                    <option value="Kerala">Kerala</option>
                    <option value="Madhya Pradesh">Madhya Pradesh</option>
                    <option value="Maharashtra">Maharashtra</option>
                    <option value="Manipur">Manipur</option>
                    <option value="Meghalaya">Meghalaya</option>
                    <option value="Mizoram">Mizoram</option>
                    <option value="Nagaland">Nagaland</option>
                    <option value="Odisha">Odisha</option>
                    <option value="Punjab">Punjab</option>
                    <option value="Rajasthan">Rajasthan</option>
                    <option value="Sikkim">Sikkim</option>
                    <option value="Tamil Nadu">Tamil Nadu</option>
                    <option value="Telangana">Telangana</option>
                    <option value="Tripura">Tripura</option>
                    <option value="Uttar Pradesh">Uttar Pradesh</option>
                    <option value="Uttarakhand">Uttarakhand</option>
                    <option value="West Bengal">West Bengal</option>
                    <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
                    <option value="Chandigarh">Chandigarh</option>
                    <option value="Dadra and Nagar Haveli and Daman and Diu">Dadra and Nagar Haveli and Daman and Diu</option>
                    <option value="Delhi">Delhi</option>
                    <option value="Lakshadweep">Lakshadweep</option>
                    <option value="Puducherry">Puducherry</option>
                    <option value="Ladakh">Ladakh</option>
                    <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                </select>
    
                <label for="district">District :</label>
                    <select id="district" name="district"  required>
                        <option value="">Select State First</option>
                    </select>
                <div>        
                <label>Police Station :</label>
                    <select id="policeStation" name="policeStation" required>
                         <option value="" >Select District first</option>
                    </select>
                </div>    
                <label for="complaintDetails" id ="head1">FIR No:</label>
                <input type="Number" id="complaintDetails" name="complaintDetails" placeholder="Enter the FIR No." required/>
                
                <label for="policeOfficerName" id="head2">FIR Date:</label>
                <input type="date" id="policeOfficerName" name="policeOfficerName" placeholder="dd/mm/yyyy" required/>
            </div>

            <div id ="captcha">
                <label class ="captcha">Enter Captcha :</label>
                <div class="form-row">
                    <div class="form-col col-md-6">
                        <input type="text" id ="capt" readonly/>
                    </div>
                    <div class="form-col col-md-6">
                        <input type="text" id ="textinput"/>
                    </div>
                    <h4>Captcha not visible <img src="./Images/arrow-fresh-refresh-icon--22.png " width="20" height="20" onClick="cap()"></img></h4>
                </div>
            </div>
           
           <button onClick="handleSubmit(event)">Search</button>
        </div>
    </form>


    <script>
        const stateDistricts = {
                   "Arunachal Pradesh" : {
                       "Anjaw":["Hayuliyang"],
                       "Dibang Valley":["Anini", "Dambuk","Hunli","Roing"],
                       "Tawang":[], "West Kameng":[], "East Kameng":[], "Papum Pare":[], "Kurung Kumey":[], "Kra Daadi":[], "Lower Subansiri":[], "Upper Subansiri":[], "West Siang":[], "East Siang":[], "Siang":[], "Upper Siang":[], "Lower Siang":[], "Lower Dibang Valley":[], "Lohit":[], "Namsai":[], "Changlang":[], "Tirap":[], "Longding":[]
                   },
                   "Andhra Pradesh":{
                       "Kadapa":["Badvel Urban", "Cuddapah_rpfscrgnt7", "Proddatur Rural"]
                   }, "Delhi":{
                    "DWARKA":["BABA HARI DASS NAGAR","BINDAPUR","CHAAWALA","DABRI","DWARKA NORTH","DWARKA SECTOR 23","DWARKA SOUTH","MOHAN GARDEN"], 
                    "EAST":["GHAZIPUR","KALYANPURI","LAXMI NAGAR","MADHU VIHAR","MAYUR VIHAR","NEW ASHOK NAGAR","PANDAV NAGAR","PREET VIHAR"], 
                    "NEW DELHI":["KARTVYA PATH","CHANKYA PURI","NORTH AVENUE","PARLIAMENT STREET","SOUTH AVENUE"], 
                    "NORTH EAST":[], 
                    "NORTH WEST":[], 
                    "ROHINI":[], 
                    "SHAHDRA":[], 
                    "SOUTH":[], 
                    "SOUTH EAST":[], 
                    "SOUTH WEST":[], 
                    "WEST":[]
                }
               // Add other states and districts similarly
           };
   
           const stateSelect = document.getElementById('state');
           const districtSelect = document.getElementById('district');
           const policeStationSelect = document.getElementById('policeStation');
   
           stateSelect.addEventListener('change', function() {
               const selectedState = stateSelect.value;
               districtSelect.innerHTML = '<option value="">Please Select</option>';
   
                 // Populate the district dropdown based on the selected state
                 if (selectedState) {
                   const districts = Object.keys(stateDistricts[selectedState]);
                 districts.forEach(district => {
                       const option = document.createElement('option');
                       option.value = district;
                       option.textContent = district;
                       districtSelect.appendChild(option);
                   });
                   // Show the district dropdown and label
                   districtSelect.style.display = 'block';
               } else {
                   // Hide the district dropdown and label if no state is selected
                   districtSelect.style.display = 'none';
               }
           })
   
           districtSelect.addEventListener('change', function() {
               const selectedState = stateSelect.value;
               const selectedDistrict = districtSelect.value;
   
               // Clear the police station dropdown
               policeStationSelect.innerHTML = '<option value="">Please Select</option>';
   
               if (selectedState && selectedDistrict) {
                   // Populate the police station dropdown based on the selected district
                   const areas = stateDistricts[selectedState][selectedDistrict] || [];
                   areas.forEach(area => {
                       const option = document.createElement('option');
                       option.value = area;
                       option.textContent = area;
                       policeStationSelect.appendChild(option);
                   });
               } 
           });
   </script>

   <script>
    function cap(){
            let alpha = ['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z','1','2'
                ,'3','4','5','6','7','8','9','0','a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v'
                ,'w','x','y','z','!','@','#','$','%','^','&','*','+'           ];
            let a = alpha[Math.floor(Math.random()*71)];
            let b = alpha[Math.floor(Math.random()*71)];
            let c = alpha[Math.floor(Math.random()*71)];
            let d = alpha[Math.floor(Math.random()*71)];
            let e = alpha[Math.floor(Math.random()*71)];
            let f = alpha[Math.floor(Math.random()*71)];

            let final = a+b+c+d+e+f;
            document.getElementById('capt').value = final;
        }

        function validcap(){
            var stg1 = document.getElementById('capt').value;
            var stg2 = document.getElementById('textinput').value;
            if(stg1 === stg2){
                return true;
            }
            else{
                alert('Please enter a valid captcha ');
                return false;
            }
        }
   </script>
   <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
   <script>
        async function handleSubmit(event){
            event.preventDefault();
            
            let state= document.querySelector('#state').value;
            let district= document.querySelector('#district').value;
            let policeStation = document.querySelector('#policeStation').value;
            let firNo = document.querySelector('#complaintDetails').value;
            let firDate = document.querySelector('#policeOfficerName').value;

            try{
                let resp = await axios.post('http://localhost:3003/trackchild/trackchildInfo', {state, district, policeStation, firNo, firDate});
                if(resp.data.message.includes('credentials matched and stored successfully')){
                    alert("credentials stored successfully");
                    window.location.href='/childDetails.html';
                }
                else{
                    alert("Enter correct credentials");
                    return;
                }
            }catch(err){
                console.log(err);
                alert("Error while submitting data");
            }
            }
   </script>
</body>
</html>